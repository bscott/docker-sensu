#!/bin/bash
set -e

for index in $@
do
	echo $index
	set -- "$index"
	IFS="/"; declare -a Array=($*)
	if [[ ${#Array[@]} -eq 1 ]]; then
		PLUGIN="${Array[0]}"
		REPO=$DEFAULT_PLUGINS_REPO
	else
		REPO="${Array[0]}"
		PLUGIN="${Array[1]}"
		VERSION="${Array[2]}"
	fi

	wget https://github.com/$REPO/sensu-plugins-$PLUGIN/archive/$VERSION.tar.gz
	tar -xzvf $VERSION.tar.gz
	rm *.tar.gz
	cd $VERSION
	sed -i'' '/signing_key/d' sensu-plugins-$PLUGIN.gemspec #We don't have the private key
	gem build sensu-plugins-$PLUGIN.gemspec
	gem uninstall -x sensu-plugins-$PLUGIN
	gem install --no-ri --no-rdoc sensu-plugins-*.gem
	cd ..
	rm -rf $VERSION
done
